name: AlfredIndicatorsCI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Setup MQL5 Compiler
      run: |
        sudo apt-get update
        sudo apt-get install -y mql5-metaeditor-cli

    - name: Compile AlfredAI Modules
      run: |
        metaeditor-cli --compile AlfredSettings.mqh
        metaeditor-cli --compile AlfredInit.mqh
        metaeditor-cli --compile AlfredLogger.mqh
        metaeditor-cli --compile AlfredSupDemCore.mq5
        metaeditor-cli --compile AlfredEA.mq5
        metaeditor-cli --compile AlfredHUD.mq5
        metaeditor-cli --compile AlfredCompass.mq5
        metaeditor-cli --compile AlfredAlertCenter.mq5
        metaeditor-cli --compile AlfredAI_Pane.mq5

    - name: Run Unit Tests
      run: metaeditor-cli --run-tests tests/

    - name: Archive Build Artifacts
      uses: actions/upload-artifact@v2
      with:
        name: AlfredAI_Build
        path: |
          MQL5/Include/AlfredSettings.ex5
          MQL5/Include/AlfredInit.ex5
          MQL5/Include/AlfredLogger.ex5
          MQL5/Include/AlfredSupDemCore.ex5
          MQL5/Include/AlfredEA.ex5
          MQL5/Include/AlfredHUD.ex5
          MQL5/Include/AlfredCompass.ex5
          MQL5/Include/AlfredAlertCenter.ex5
          MQL5/Include/AlfredAI_Pane.ex5
